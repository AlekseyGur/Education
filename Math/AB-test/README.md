# Проведение А/Б тестирования

Делаются две страницы сайта с разным дизайном. На каждую направляется 50% посетителей. Пытаются определить, какая страница привлекательнее, у какой больше конверсия. 

Выдвигаются гипотезы:<br>
H0 - конверсия на странице А и Б равны.<br>
H1 - конверсии различаются.<br>

Делаем страница А и Б, начинаем набирать статистику.<br>
Страница А:<br>
Посещения = 2509<br>
Количество целевых действий = 77 (3,068 %)<br>

Страница Б:<br>
Посещения = 1465<br>
Количество целевых действий = 60 (4,095 %)<br>

Будем применять однофакторный дисперсионный анализ. Для этого построим для каждой страницы массив из единиц и нулей (1-целевое действие, 0-пустое посещение).

Определяем является ли значимым отличие конверсии А и Б. 

## Решение

```Python
# Собранная статистика для страницы А:
a = 2509  # посещения
a_true = 77  # количество целевых действий

# Собранная статистика для страницы Б:
b = 1465  # посещения
b_true = 60  # количество целевых действий

total_conversion = (a_true + b_true) / (a + b)

alpha = 0.05  # задаём уровень значимости. Обычно берут 5%.
power = 0.8  # задаём мощность теста. Обычно задают более 80% 

import numpy as np
from scipy import stats 

y1 = np.zeros(2509)
y1[np.arange(77)] = 1

y2 = np.zeros(1465)
y2[np.arange(60)] = 1

y = np.concatenate([y1, y2])

n1 = y1.shape[0]
n2 = y2.shape[0]
n = n1 + n2

y1_mean = y1.mean()
y2_mean = y2.mean()
y_mean = y.mean()

# отклонение от среднего
SS_b = n1*(y1_mean-y_mean)**2 + n2*(y2_mean-y_mean)**2
# отклонение внутри группы
SS_w = ((y1_mean-y_mean)**2).sum() + (n2*(y2_mean-y_mean)**2).sum()

k = 2  # две степени свободы - сделал целевое действие / не сделал
k1 = k - 1
k2 = n - k

sigma2_b = SS_b / k1
sigma2_w = SS_w / k2

T = sigma2_b / sigma2_w

F_crit = stats.f.ppf(1-alpha, k1, k2)

# смотрим был ли преодолён пороговый размер выборки для этих показателей.
# Если нет, то результаты могут быть неточными

mde = abs(y1_mean - y2_mean)

# standard normal distribution to determine z-values
standard_norm = stats.norm(0, 1)

# find Z_beta from desired power
Z_beta = standard_norm.ppf(power)

# find Z_alpha
Z_alpha = standard_norm.ppf(1 - alpha/2)

# average of probabilities from both groups
pooled_prob = (total_conversion + total_conversion + mde) / 2

min_N = (2 * pooled_prob * (1 - pooled_prob) * (Z_beta + Z_alpha)**2
         / mde**2)

min_N = round(min_N)

s_size = min_sample_size(bcr=total_conversion, mde=y1_mean-y2_mean, power=power, sig_level=alpha)


# Делаем выводы

print(f'Конверсия страницы А: {round(y1_mean*100, 3)}%')
print(f'Конверсия страницы Б: {round(y2_mean*100, 3)}%')

if F_crit < T:
    print(f'А и Б работают одинаково. Между ними нет статистически значимой разницы.')
else:
    print(f'А и Б работают с разной эффективностью. Между ними есть статистически значимая разница.')

print(f'Минимальный размер выборки для надёжного результата: {s_size}')

if s_size > a + b:
    print(f'Полученные результаты не являются точными. ' + \
          f'Потому что размер выборки недостаточен для получения надёжного ответа. ' + \
          f'Нужно набрать ещё {s_size - (a + b)} событий (ещё {round(100*(s_size - (a + b))/s_size)}%), ' + \
          f'чтобы сумме нужно набрать минимум {s_size} событий.')
```

# Результат работы скрипта

Конверсия страницы А: 3.069%

Конверсия страницы Б: 4.096%

А и Б работают одинаково. Между ними нет статистически значимой разницы.

Минимальный размер выборки для надёжного результата: 4242

Полученные результаты не являются точными. Потому что размер выборки недостаточен для получения надёжного ответа. Нужно набрать ещё 268 событий (ещё 6%), чтобы сумме нужно набрать минимум 4242 событий.
