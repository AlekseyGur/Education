# Задача про две коробки с шарами

Есть 2 коробки. В одной находится 8 шаров, из которых 5 белые, остальные чёрные. Во второй 12 шаров, из которых 5 белые. Из первой коробки вытащили 2 случайных шара. Из второй коробки вытащили 4 случайных шара. Найти вероятность того, что в получившейся выборке будет ровно 3 белых шара.

## Решение через перебор всех вариантов

Количество шаров в коробках непрерывно меняется. А следовательно, изменяется и вероятность получить белый. Поэтому необходимо вручную пересчитать вероятность каждого возможного исхода. Для этого сделаем таблицу, в которой "+" - это белые шары:

| 1 | 1 | 2 | 2 | 2 | 2 |
|---|---|---|---|---|---|
| + | + | + | - | - | - |
| + | - | + | + | - | - |
| - | + | + | + | - | - |
| - | - | + | + | + | - |
| - | - | + | - | + | + |
| - | - | + | + | - | + |
| - | - | - | + | + | + |
| + | + | - | + | - | - |
| + | + | - | - | + | - |
| + | + | - | - | - | + |
| + | - | + | - | + | - |
| + | - | + | - | - | + |
| + | - | - | + | - | + |
| + | - | - | - | + | + |
| + | - | - | + | + | - |
| - | + | + | - | + | - |
| - | + | + | - | - | + |
| - | + | - | + | - | + |
| - | + | - | - | + | + |
| - | + | - | + | + | - |

Три шара из шести могут быть получены 20 разными способами (количество комбинаций 6!/(3!*(6-3)!)).

Начальная вероятность достать белый шар из первой коробки - 5/8, а черный - 3/8.
Начальная вероятность достать белый шар из второй коробки - 5/12, а черный - 7/12.

Вероятность получить чёрный шар = (1 - вероятность получить белый). При этом количество шаров (число в знаменателе) постоянно убывает, потому что шары изымаются из коробок. То есть если достаём первой коробки шар, то вероятность получить белый 5/8, а на следующий шар вероятность станет 4/7. Аналогично вероятность достать из неё же чёрный изменится на с 3/8 на 3/7.

Теперь если идти по полученной таблице построчно, заменяя плюсы на вероятность получения белого шара, а минусы на вероятность получения чёрного, то можно получить такую таблицу:

| 1   | 1   | 2    | 2    | 2    | 2   |
|-----|-----|------|------|------|-----|
| 5/8 | 4/7 | 5/12 | 7/11 | 6/10 | 5/9 |
| 5/8 | 3/7 | 5/12 | 4/11 | 7/10 | 6/9 |
| 3/8 | 5/7 | 5/12 | 4/11 | 7/10 | 6/9 |
| 3/8 | 2/7 | 5/12 | 4/11 | 3/10 | 7/9 |
| 3/8 | 2/7 | 5/12 | 7/11 | 4/10 | 3/9 |
| 3/8 | 2/7 | 5/12 | 4/11 | 7/10 | 3/9 |
| 3/8 | 2/7 | 7/12 | 5/11 | 4/10 | 3/9 |
| 5/8 | 4/7 | 7/12 | 5/11 | 6/10 | 5/9 |
| 5/8 | 4/7 | 7/12 | 6/11 | 5/10 | 5/9 |
| 5/8 | 4/7 | 7/12 | 6/11 | 5/10 | 5/9 |
| 5/8 | 3/7 | 5/12 | 7/11 | 4/10 | 6/9 |
| 5/8 | 3/7 | 5/12 | 7/11 | 6/10 | 4/9 |
| 5/8 | 3/7 | 7/12 | 5/11 | 6/10 | 4/9 |
| 5/8 | 3/7 | 7/12 | 6/11 | 5/10 | 4/9 |
| 5/8 | 3/7 | 7/12 | 5/11 | 4/10 | 6/9 |
| 3/8 | 5/7 | 5/12 | 7/11 | 4/10 | 6/9 |
| 3/8 | 5/7 | 5/12 | 7/11 | 6/10 | 4/9 |
| 3/8 | 5/7 | 7/12 | 5/11 | 6/10 | 4/9 |
| 3/8 | 5/7 | 7/12 | 6/11 | 5/10 | 4/9 |
| 3/8 | 5/7 | 7/12 | 5/11 | 4/10 | 6/9 |

Эта таблица состоит только из вероятностей случаев, в которых 3 из 6 шаров оказались белыми. Теперь если перемножить все значения в каждой строке, а потом сложить все эти результаты, то получим полную вероятность события. Она составит 0,368686868686869

Это решение с помощью простого перебора всех вариантов вручную. Но чтобы не трудиться, можно всё запрограммировать. Далее приведен разбор кода автоматизации задачи на Python и оценки методом Монте-Карло на языке R.

## Python

Запрограммируем всю вышеизложенную логику, чтобы можно было решать задачи с любым количеством коробок, шаров и размером итоговой выборки. В начале кода задаются переменные с содержимым ящиков, их количеством и размером выборки:

```Python
from itertools import permutations, product

sum_white = 3 # сколько всего получилось белых в итоговой суммарной выборке
boxes = {
    0: { # 1-ая коробка содержит 5 белых и 8 черных, из которых выбирают 2
        'white': 5, # количество белых шаров
        'total': 8, # полное количество шаров в коробке
        'pick': 2 # сколько достают из коробки
    },
    1: { # 2-ая коробка содержит 5 белых и 12 черных, из которых выбирают 4
        'white': 5, # количество белых шаров
        'total': 12, # полное количество шаров в коробке
        'pick': 4 # сколько достают из коробки
    }
}


res = []
# делаем представление из "+" и "-" для каждой коробки
for idx, val in boxes.items():
    boxes[idx].update({'combinations':
                    ['+' for _ in range(boxes[idx]['white'])] +
                    ['-' for _ in range(boxes[idx]['total'] - boxes[idx]['white'])]
                })

    # перебираем все возможные комбинации расположений "+" и "-"
    var = [''.join(i) for i in permutations(val['combinations'], val['pick'])]
    # удаляем те комбинации, где "+" и "-" больше нужной суммы
    var = [i for i in var if i.count('+') <= sum_white]
    res.append(list(set(var)))

# получаем сочетания всех коробок со всеми
res = [''.join(i) for i in product(*res)]
# оставляем только те сочетания, где "+" и "-" столько, сколько нужно
res = [i for i in res if i.count('+') == sum_white]

print(f'Всего комбинаций: {len(res)}. "+" - вероятность получения белого шара, "-" вероятность получения чёрного:')
for row in res:
    for i in row:
        print(f'{i:>2}', end = '')
    print()


# в полученной таблице преобразуем "+" и "-" в дроби вероятностей
probability = []
for row in res:
    tmp_row = []
    start = 0
    for box_idx, box_val in boxes.items():
        c = row[start:box_val['pick']+start]
        start = box_val['pick']
        tmp = []
        total = boxes[box_idx]['total']
        white = boxes[box_idx]['white']
        for i, val in enumerate(c):
            s = ''
            if val == '+':
                s = f'{white}/{total}'
                white -= 1
            else:
                s = f'{total - white}/{total}'
            tmp.append(s)
            total -= 1

        tmp_row.extend(tmp)
    probability.append(tmp_row)


print('Комбинации в вероятностях:')
for row in probability:
    for i in row:
        print(f'{i:>6}', end = '')
    print()

# перемножаем все вероятности в строках и суммируем результаты строк
probability = sum([eval('*'.join(i)) for i in probability])
print('Общая вероятность:', probability)

```

При запуске скрипта получаем то же самое, что и раньше, во время теоретических расчётов (немного приукрасил таблицы, чтобы на github смотрелись лучше):

Всего комбинаций: 20. "+" - вероятность получения белого шара, "-" вероятность получения чёрного:

| 1   | 1   | 2    | 2    | 2    | 2   |
|-----|-----|------|------|------|-----|
| - | + | + | - | - | + |
| - | + | - | + | - | + |
| - | + | + | - | + | - |
| - | + | + | + | - | - |
| - | + | - | - | + | + |
| - | + | - | + | + | - |
| + | - | + | - | - | + |
| + | - | - | + | - | + |
| + | - | + | - | + | - |
| + | - | + | + | - | - |
| + | - | - | - | + | + |
| + | - | - | + | + | - |
| - | - | + | - | + | + |
| - | - | - | + | + | + |
| - | - | + | + | + | - |
| - | - | + | + | - | + |
| + | + | - | - | - | + |
| + | + | - | - | + | - |
| + | + | + | - | - | - |
| + | + | - | + | - | - |

Комбинации в вероятностях:

| 1   | 1   | 2    | 2    | 2    | 2   |
|-----|-----|------|------|------|-----|
| 3/8 | 5/7 | 5/12 | 7/11 | 6/10 | 4/9 |
| 3/8 | 5/7 | 7/12 | 5/11 | 6/10 | 4/9 |
| 3/8 | 5/7 | 5/12 | 7/11 | 4/10 | 6/9 |
| 3/8 | 5/7 | 5/12 | 4/11 | 7/10 | 6/9 |
| 3/8 | 5/7 | 7/12 | 6/11 | 5/10 | 4/9 |
| 3/8 | 5/7 | 7/12 | 5/11 | 4/10 | 6/9 |
| 5/8 | 3/7 | 5/12 | 7/11 | 6/10 | 4/9 |
| 5/8 | 3/7 | 7/12 | 5/11 | 6/10 | 4/9 |
| 5/8 | 3/7 | 5/12 | 7/11 | 4/10 | 6/9 |
| 5/8 | 3/7 | 5/12 | 4/11 | 7/10 | 6/9 |
| 5/8 | 3/7 | 7/12 | 6/11 | 5/10 | 4/9 |
| 5/8 | 3/7 | 7/12 | 5/11 | 4/10 | 6/9 |
| 3/8 | 2/7 | 5/12 | 7/11 | 4/10 | 3/9 |
| 3/8 | 2/7 | 7/12 | 5/11 | 4/10 | 3/9 |
| 3/8 | 2/7 | 5/12 | 4/11 | 3/10 | 7/9 |
| 3/8 | 2/7 | 5/12 | 4/11 | 7/10 | 3/9 |
| 5/8 | 4/7 | 7/12 | 6/11 | 5/10 | 5/9 |
| 5/8 | 4/7 | 7/12 | 6/11 | 5/10 | 5/9 |
| 5/8 | 4/7 | 5/12 | 7/11 | 6/10 | 5/9 |
| 5/8 | 4/7 | 7/12 | 5/11 | 6/10 | 5/9 |

Общая вероятность: 0.3686868686868687


## R

Пример для Python был запрограммирован буквально по всем тем шагам, которые нужны для решения задачи "теоретическим" путём. Но есть и другие способы решения задач. К примеру, проведение оценки методом Монте-Карло. Для этого надо написать программу, которая будет разыграть событие получения этих трёх шаров очень много раз.

Программа будет проводить эксперимент снова и снова, подсчитывая количество экспериментов, в которых удалось достать ровно три белых шара. А затем посчитает вероятность такого исхода (поделит количество экспериментов с 3 шарами на полное количество экспериментов)

```R
# первая коробка содержит 5 (они же единицы "1") белых шаров и
# 3 чёрных (они же нули "0"). Всего 8 шаров
a <- c(1, 1, 1, 1, 1, 0, 0, 0)

# вторая коробка содержит 5 из 12 белых
b <- c(1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0)

# берём из первой коробки 2 случайных, из второй - 4
sa <- sample(a, 2)
sb <- sample(b, 4)

# складываем полученные в одну кучу (сложение векторов функцией "c")
# и суммируем белые
sum(c(sa, sb))

# По условию задачи мы хотим найти вероятности, с которой вытащим ровно
# 3 белых. То есть нужно посчитать вероятность получить в переменной "s"
# число 3. Но при выполнении этого кода там может оказаться любое число
# от 0 до 6. Поэтому нам нужно запустить код очень много раз и узнать,
# с какой вероятностью выпадает число 3.

# Для удобства обернём код в функцию:
mc <- function(a, b){
    sa <- sample(a, 2)
    sb <- sample(b, 4)
    sum(c(sa, sb))
}

# И выполним её миллион раз:
m <- replicate(1000000, mc(a, b))

# В переменную "m" будет записана последовательности из сотни возможных
# значений "s". Остаётся только посчитать долю значений, которые равны 3,
# что и просят сделать в задании.

mean(m == 3) # сначала сравниваем каждое число из выборки с 3 и возвращаем
# список из True / False. Затем функция mean суммирует все 1 (они же True)
# и делит на общее количество элементов

# получим число 0,368149, что до третьего порядка после запятой совпадает
# с теоретическим значением 0,368686868686869

# Для понимания зависимости точности от количества повторений сделаем
# повтор только 100 раз:
m <- replicate(100, mc(a, b))
mean(m == 3) # получим значение 0.31
```

Как можно заметить на практике, такой метод безумно долгий, если нужно получить более-менее точную вероятность. Поэтому к нему прибегают в том случае, когда теоретический расчёт сделать уж очень сложно. К примеру, в ядерной физике.
